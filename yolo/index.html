<!DOCTYPE html>
<html>
  <head><meta charset="UTF-8"><title>Oosit ONNX Test</title></head>
  <body>
    <h2>ONNX Model Test</h2>
    <input type="file" id="fileInput" accept="image/*">
    <canvas id="canvas" width="512" height="512"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.min.js"></script>
    <script>
      async function runModel(imageData) {
        const session = await ort.InferenceSession.create("model.onnx");
        const imgData = new Float32Array(imageData.data.length / 4 * 3);
        for (let i = 0, j = 0; i < imageData.data.length; i += 4, j += 3) {
          imgData[j] = imageData.data[i] / 255.0;
          imgData[j + 1] = imageData.data[i + 1] / 255.0;
          imgData[j + 2] = imageData.data[i + 2] / 255.0;
        }
        const inputTensor = new ort.Tensor("float32", imgData, [1, 3, 512, 512]);
        const results = await session.run({ images: inputTensor });
        console.log(results);
      }

      document.getElementById("fileInput").addEventListener("change", async (e) => {
        const ctx = document.getElementById("canvas").getContext("2d");
        const img = new Image();
        img.onload = async () => {
          ctx.drawImage(img, 0, 0, 512, 512);
          const imageData = ctx.getImageData(0, 0, 512, 512);
          await runModel(imageData);
        };
        img.src = URL.createObjectURL(e.target.files[0]);
      });
    </script>
  </body>
</html>
